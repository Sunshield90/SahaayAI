<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SahaayAI: AI for Youth Mental Wellness</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

    <style>
        :root {
            --primary-blue: #5e72e4;
            --secondary-teal: #11cdef;
            --accent-purple: #8965e0;
            --dark-bg: #172b4d;
            --light-bg: #f4f5f7;
            --text-light: #ffffff;
            --text-dark: #32325d;
            --text-muted: #8898aa;
            --gradient-primary: linear-gradient(135deg, var(--primary-blue) 0%, var(--accent-purple) 100%);
            --gradient-secondary: linear-gradient(135deg, var(--secondary-teal) 0%, var(--primary-blue) 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--text-light);
            color: var(--text-dark);
            line-height: 1.7;
            overflow-x: hidden;
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        section {
            padding: 80px 0;
        }

        h1, h2, h3 {
            font-weight: 600;
            line-height: 1.3;
        }

        h2 {
            font-size: 2.5rem;
            text-align: center;
            margin-bottom: 40px;
            color: var(--text-dark);
        }
        
        h2 span {
            background: var(--gradient-secondary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        p {
            margin-bottom: 20px;
            color: var(--text-muted);
        }

        .btn {
            display: inline-block;
            padding: 12px 30px;
            border-radius: 50px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: var(--text-light);
            box-shadow: 0 4px 6px rgba(50, 50, 93, 0.11), 0 1px 3px rgba(0, 0, 0, 0.08);
        }
        
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 14px rgba(50, 50, 93, 0.1), 0 3px 6px rgba(0, 0, 0, 0.08);
        }
        
        .btn-secondary {
            background-color: #e9ecef;
            color: var(--primary-blue);
        }
        .btn-secondary:hover {
            background-color: #dee2e6;
        }

        header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            padding: 15px 0;
            background-color: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            z-index: 1000;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: 700;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        #hero {
            background-image: url('https://www.girlsintocoding.com/wp-content/uploads/AiKids-scaled.jpeg');
            background-size: cover;
            background-position: center;
            min-height: 100vh;
            display: flex;
            align-items: center;
            text-align: center;
            padding-top: 80px;
            position: relative;
            color: white;
        }
        
        #hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(23, 43, 77, 0.5);
            z-index: 1;
        }
        
        .hero-content {
            position: relative;
            z-index: 2;
        }

        #hero h1 {
            font-size: 4rem;
            font-weight: 700;
            margin-bottom: 20px;
            color: white;
        }

        #hero p {
            font-size: 1.2rem;
            max-width: 600px;
            margin: 0 auto 30px;
            color: rgba(255, 255, 255, 0.9);
        }
        
        .problem-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 50px;
            align-items: center;
        }

        .problem-visual {
            background: #eef2ff;
            border-radius: 20px;
            padding: 40px;
            text-align: center;
        }
        .problem-visual img {
            max-width: 100%;
            height: auto;
            max-height: 300px;
        }

        #solution {
            background-color: var(--light-bg);
        }

        .solution-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 50px;
            align-items: center;
        }
        
        .chat-mockup {
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 15px 35px rgba(50, 50, 93, 0.1), 0 5px 15px rgba(0, 0, 0, 0.07);
            border: 5px solid #e9ecef;
        }
        
        .chat-header {
            display: flex;
            align-items: center;
            padding-bottom: 15px;
            border-bottom: 1px solid #e9ecef;
        }
        .chat-header .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--gradient-secondary);
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 1.2rem;
            margin-right: 15px;
        }
        .chat-header .name { font-weight: 600; }

        .chat-body { padding: 20px 0; }
        .chat-bubble {
            padding: 10px 15px;
            border-radius: 18px;
            max-width: 80%;
            margin-bottom: 10px;
            line-height: 1.5;
        }
        .user {
            background-color: var(--primary-blue);
            color: white;
            border-bottom-right-radius: 4px;
            margin-left: auto;
        }
        .sahaayai {
            background-color: #f1f3f5;
            color: var(--text-dark);
            border-bottom-left-radius: 4px;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
        }
        .feature-card {
            background: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(50, 50, 93, 0.05), 0 1px 3px rgba(0, 0, 0, 0.03);
            transition: all 0.3s ease;
        }
        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 7px 14px rgba(50, 50, 93, 0.1), 0 3px 6px rgba(0, 0, 0, 0.08);
        }
        .feature-card .icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
            background: var(--gradient-secondary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .feature-card h3 {
            font-size: 1.1rem;
            font-weight: 500;
            color: var(--text-dark);
        }

        #how-it-works {
            background-color: var(--light-bg);
        }
        .process-flow {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            position: relative;
        }
        .process-step {
            text-align: center;
            width: 30%;
            position: relative;
        }
        .step-number {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--gradient-primary);
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem;
            font-weight: 600;
            margin: 0 auto 20px;
            box-shadow: 0 4px 6px rgba(50, 50, 93, 0.11), 0 1px 3px rgba(0, 0, 0, 0.08);
        }
        .process-step h3 {
            font-size: 1.2rem;
            margin-bottom: 10px;
        }
        .process-step:not(:last-child)::after {
            content: '';
            position: absolute;
            top: 30px;
            left: 80%;
            width: 130%;
            height: 2px;
            background-image: linear-gradient(to right, #ccc 50%, transparent 50%);
            background-size: 10px 2px;
            background-repeat: repeat-x;
            z-index: -1;
        }

        .tech-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 50px;
            align-items: center;
        }
        .tech-list ul {
            list-style: none;
        }
        .tech-list li {
            font-size: 1.1rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        .tech-list i {
            color: var(--secondary-teal);
            margin-right: 15px;
            font-size: 1.3rem;
        }
        .tech-logos {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            align-items: center;
        }
        .tech-logos img {
            height: 40px;
            opacity: 0.7;
            transition: opacity 0.3s ease;
            object-fit: contain;
        }
        .tech-logos img:hover {
            opacity: 1;
        }

        #impact {
            background-color: var(--light-bg);
        }
        .impact-content {
            text-align: center;
            max-width: 800px;
            margin: 0 auto;
        }
        .timeline {
            margin-top: 50px;
            display: flex;
            justify-content: space-between;
            position: relative;
        }
        .timeline::before {
            content: '';
            position: absolute;
            top: 10px;
            left: 0;
            width: 100%;
            height: 4px;
            background: #e9ecef;
            border-radius: 2px;
        }
        .timeline-item {
            position: relative;
            text-align: center;
            width: 25%;
        }
        .timeline-dot {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: white;
            border: 4px solid var(--primary-blue);
        }
        .timeline-item:first-child .timeline-dot {
            border-color: var(--accent-purple);
        }
        .timeline-item:nth-child(2) .timeline-dot {
            border-color: var(--primary-blue);
        }
        .timeline-item:nth-child(3) .timeline-dot {
            border-color: var(--secondary-teal);
        }
        .timeline-item:last-child .timeline-dot {
            border-color: #2dce89;
        }
        .timeline-content {
            margin-top: 40px;
        }
        .timeline-content h4 {
            font-weight: 600;
        }

        #cta {
            background: var(--gradient-primary);
            text-align: center;
            color: white;
        }
        #cta h2 {
            color: white;
            margin-bottom: 20px;
        }
        #cta p {
            color: rgba(255, 255, 255, 0.8);
            max-width: 600px;
            margin: 0 auto 30px;
        }
        .cta-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
        }
        
        footer {
            background-color: var(--dark-bg);
            color: var(--text-muted);
            padding: 40px 0;
            text-align: center;
        }
        .footer-links {
            margin-bottom: 20px;
        }
        .footer-links a {
            color: var(--text-muted);
            text-decoration: none;
            margin: 0 15px;
            transition: color 0.3s ease;
        }
        .footer-links a:hover {
            color: var(--text-light);
        }
        .social-icons a {
            color: var(--text-muted);
            text-decoration: none;
            font-size: 1.5rem;
            margin: 0 10px;
            transition: color 0.3s ease;
        }
        .social-icons a:hover {
            color: var(--secondary-teal);
        }
        .footer-note {
            margin-top: 20px;
            font-size: 0.9rem;
            border-top: 1px solid #32325d;
            padding-top: 20px;
        }

        .chat-widget {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 370px;
            max-width: 90vw;
            height: 80vh;
            max-height: 600px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transform: scale(0);
            transform-origin: bottom right;
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 1001;
        }

        .chat-widget.open {
            transform: scale(1);
        }

        .chat-widget-header {
            padding: 15px 20px;
            background: var(--gradient-primary);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-widget-header h3 {
            font-size: 1.2rem;
            font-weight: 600;
        }
        
        .chat-widget-header .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        .chat-messages {
            flex-grow: 1;
            padding: 20px;
            overflow-y: auto;
        }
        
        .typing-indicator {
            display: flex;
            align-items: center;
            padding: 10px 15px;
        }
        .typing-indicator span {
            height: 8px;
            width: 8px;
            background-color: #ccc;
            border-radius: 50%;
            display: inline-block;
            margin: 0 2px;
            animation: bounce 1.4s infinite ease-in-out both;
        }
        .typing-indicator span:nth-child(1) { animation-delay: -0.32s; }
        .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }
        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1.0); }
        }


        .chat-input-form {
            display: flex;
            padding: 15px;
            border-top: 1px solid #eee;
        }
        .chat-input-form input {
            flex-grow: 1;
            border: 1px solid #ddd;
            border-radius: 50px;
            padding: 10px 15px;
            font-size: 1rem;
            font-family: 'Poppins', sans-serif;
        }
        .chat-input-form input:focus {
            outline: none;
            border-color: var(--primary-blue);
        }

        .chat-input-form button {
            background: var(--primary-blue);
            color: white;
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            margin-left: 10px;
            font-size: 1.2rem;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .chat-input-form button:hover {
            background: var(--accent-purple);
        }
        

        @media (max-width: 992px) {
            h2 { font-size: 2.2rem; }
            .process-flow { flex-direction: column; align-items: center; gap: 50px; }
            .process-step { width: 80%; }
            .process-step:not(:last-child)::after {
                content: '\f063';
                font-family: 'Font Awesome 6 Free';
                font-weight: 900;
                position: absolute;
                top: 120%;
                left: 50%;
                transform: translateX(-50%);
                width: auto;
                height: auto;
                background-image: none;
                background: none;
                color: #ccc;
                font-size: 1.5rem;
            }
        }

        @media (max-width: 768px) {
            h1 { font-size: 3rem; }
            .problem-content, .solution-content, .tech-content {
                grid-template-columns: 1fr;
            }
            .solution-content { grid-template-rows: auto auto; }
            .solution-content .chat-mockup { grid-row: 1 / 2; }
            
            .timeline { flex-direction: column; gap: 40px; align-items: flex-start;}
            .timeline::before {
                left: 11px;
                top: 0;
                width: 4px;
                height: 100%;
            }
            .timeline-item { width: 100%; text-align: left; padding-left: 50px; }
            .timeline-dot { left: 0; transform: translateX(0); }
            .timeline-content { margin-top: -10px; }

            .cta-buttons { flex-direction: column; align-items: center; }
            
            .chat-widget {
                bottom: 0;
                right: 0;
                width: 100vw;
                height: 90vh;
                border-radius: 0;
            }
        }
    </style>
</head>
<body>

    <header>
        <div class="container">
            <nav>
                <div class="logo">SahaayAI</div>
                <button class="btn btn-secondary open-chat-btn">Try Prototype</button>
            </nav>
        </div>
    </header>

    <main>
        <section id="hero">
            <div class="container">
                <div class="hero-content">

                    <h1>SahaayAI</h1>
                    <p>Confidential. Empathetic. AI-powered support for youth mental wellness.</p>
                    <button class="btn btn-primary open-chat-btn">Try the Prototype</button>
                </div>
            </div>
        </section>

        <section id="problem">
            <div class="container">
                <h2>Why <span>Mental Wellness</span> for Youth?</h2>
                <div class="problem-content">
                    <div class="problem-text">
                        <p>Mental health stigma in India, especially among students, often prevents them from seeking help. Traditional care can be costly, inaccessible, or surrounded by social taboos. As a result, millions of young people face challenges like academic pressure, social anxiety, and stress in silence.</p>
                    </div>
                    <div class="problem-visual">
                         <img src="https://assets.thehansindia.com/h-upload/2023/07/23/1366791-ai.jpg" alt="Infographic showing stressors like exams, social pressure, and stigma affecting youth.">
                    </div>
                </div>
            </div>
        </section>

        <section id="solution">
            <div class="container">
                <h2>Our <span>Solution</span></h2>
                <div class="solution-content">
                    <div class="solution-text">
                        <p>SahaayAI is an anonymous AI companion designed to be a safe first step. It offers empathetic conversations, provides support in multiple languages (English, Hindi, and Hinglish), and is trained to detect crisis situations. It can guide users to verified local resources, breaking down barriers to professional help.</p>
                    </div>
                    <div class="chat-mockup">
                        <div class="chat-header">
                            <div class="avatar"><i class="fa-solid fa-robot"></i></div>
                            <div class="name">SahaayAI</div>
                        </div>
                        <div class="chat-body">
                            <div class="chat-bubble sahaayai">Hey! I'm here to listen. Sab theek hai?</div>
                            <div class="chat-bubble user">Hey. Bas exams ka thoda stress hai.</div>
                            <div class="chat-bubble sahaayai">I understand, exam pressure can be tough. Chalo, let's talk about it. Kabhi kabhi baat karne se hi better feel hota hai.</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="features">
            <div class="container">
                <h2>What <span>SahaayAI</span> Offers</h2>
                <div class="features-grid">
                    <div class="feature-card">
                        <div class="icon"><i class="fa-solid fa-user-secret"></i></div>
                        <h3>Anonymous, stigma-free chat</h3>
                    </div>
                    <div class="feature-card">
                        <div class="icon"><i class="fa-solid fa-book-open"></i></div>
                        <h3>Mood check-ins & journaling</h3>
                    </div>
                    <div class="feature-card">
                        <div class="icon"><i class="fa-solid fa-triangle-exclamation"></i></div>
                        <h3>Crisis detection & safe escalation</h3>
                    </div>
                    <div class="feature-card">
                        <div class="icon"><i class="fa-solid fa-map-location-dot"></i></div>
                        <h3>Local NGO & helpline finder</h3>
                    </div>
                    <div class="feature-card">
                        <div class="icon"><i class="fa-solid fa-users"></i></div>
                        <h3>AI-moderated peer support</h3>
                    </div>
                </div>
            </div>
        </section>

        <section id="how-it-works">
            <div class="container">
                <h2>Simple, Safe, <span>Supportive</span></h2>
                <div class="process-flow">
                    <div class="process-step">
                        <div class="step-number">1</div>
                        <h3>Log in anonymously</h3>
                        <p>No names, no sign-ups. Your privacy is our priority.</p>
                    </div>
                    <div class="process-step">
                        <div class="step-number">2</div>
                        <h3>Chat with SahaayAI</h3>
                        <p>Share what's on your mind and get instant, non-judgmental support.</p>
                    </div>
                    <div class="process-step">
                        <div class="step-number">3</div>
                        <h3>Access Resources</h3>
                        <p>Get guided to verified helplines or professionals if you need more help.</p>
                    </div>
                </div>
            </div>
        </section>
        
        <section id="tech">
            <div class="container">
                 <h2>Powered by <span>Google Cloud</span></h2>
                 <div class="tech-content">
                    <div class="tech-list">
                        <ul>
                            <li><i class="fa-solid fa-check-circle"></i>Vertex AI for generative AI conversations</li>
                            <li><i class="fa-solid fa-check-circle"></i>Firebase for authentication, hosting, and analytics</li>
                            <li><i class="fa-solid fa-check-circle"></i>Firestore for secure, encrypted data storage</li>
                            <li><i class="fa-solid fa-check-circle"></i>Simple safety filters for crisis detection</li>
                        </ul>
                    </div>
                    <div class="tech-logos">
                        <img src="https://logowik.com/content/uploads/images/google-cloud.jpg" alt="Google Cloud Logo">
                        <img src="https://4.bp.blogspot.com/-Fxo_qnGJBj0/WRoDPNdlEII/AAAAAAAABF0/1mSHmv5gleQaCsHKEDgTB3DbNghjCXvZACLcB/s1600/logo_firebase_1920px_clr.png" alt="Firebase Logo">
                        <img src="https://netforemost.com/wp-content/uploads/2024/09/google-vertex-ai.jpg" alt="Vertex AI Logo">
                        <img src="https://cdn4.iconfinder.com/data/icons/logos-3/600/React.js_logo-512.png" alt="React Logo">
                    </div>
                </div>
            </div>
        </section>

        <section id="impact">
            <div class="container">
                <h2>Our <span>Vision</span></h2>
                <div class="impact-content">
                    <p>To make mental wellness accessible, stigma-free, and culturally relevant for every student in India. We aim to grow from a functional prototype to campus pilots, and eventually, a nationwide support system.</p>
                    <div class="timeline">
                        <div class="timeline-item">
                            <div class="timeline-dot"></div>
                            <div class="timeline-content">
                                <h4>Now</h4>
                                <p>MVP</p>
                            </div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-dot"></div>
                            <div class="timeline-content">
                                <h4>Next</h4>
                                <p>Campus Pilots</p>
                            </div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-dot"></div>
                            <div class="timeline-content">
                                <h4>Future</h4>
                                <p>Public Launch</p>
                            </div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-dot"></div>
                            <div class="timeline-content">
                                <h4>Goal</h4>
                                <p>Nationwide Scale</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="cta">
            <div class="container">
                <h2>Join Us</h2>
                <p>Be part of building a stigma-free path to youth mental wellness in India. Try our prototype or get in touch to collaborate.</p>
                <div class="cta-buttons">
                    <button class="btn btn-light btn-secondary open-chat-btn">Try Prototype</button>
                    <a href="mailto:contact@sahaay.ai" class="btn btn-outline-light">Contact Us</a>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <div class="footer-links">
                <a href="#">About</a> |
                <a href="mailto:contact@sahaay.ai">Contact</a> |
                <a href="#">Privacy Policy</a>
            </div>
            <div class="social-icons">
                <a href="#" aria-label="LinkedIn"><i class="fab fa-linkedin"></i></a>
                <a href="#" aria-label="GitHub"><i class="fab fa-github"></i></a>
                <a href="mailto:contact@sahaay.ai" aria-label="Email"><i class="fas fa-envelope"></i></a>
            </div>
            <div class="footer-note">
                <p>&copy; 2025 SahaayAI. All Rights Reserved.</p>
                <p><strong>Disclaimer:</strong> SahaayAI is a prototype and not a substitute for professional medical advice, diagnosis, or treatment. If you are in a crisis, please contact a local emergency number immediately.</p>
            </div>
        </div>
    </footer>
    
    <div class="chat-widget" id="chat-widget">
        <div class="chat-widget-header">
            <h3>Chat with SahaayAI</h3>
            <button class="close-btn" id="close-chat-btn">&times;</button>
        </div>
        <div class="chat-messages" id="chat-messages">
        </div>
        <form class="chat-input-form" id="chat-form">
            <input type="text" id="chat-input" placeholder="Type your message..." autocomplete="off">
            <button type="submit" id="send-btn"><i class="fas fa-paper-plane"></i></button>
        </form>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const chatWidget = document.getElementById('chat-widget');
        const openChatBtns = document.querySelectorAll('.open-chat-btn');
        const closeChatBtn = document.getElementById('close-chat-btn');
        const chatMessages = document.getElementById('chat-messages');
        const chatForm = document.getElementById('chat-form');
        const chatInput = document.getElementById('chat-input');
        const sendBtn = document.getElementById('send-btn');
        
        let chatHistory = [];
        let apiKey = sessionStorage.getItem('geminiApiKey') || null;
        let isAwaitingApiKey = false;

        const systemPrompt = `You are SahaayAI, a warm, empathetic, and supportive AI companion. Your primary goal is to provide a safe, non-judgmental space for young people in India to talk about their stress, anxiety, and mental wellness challenges.

        RULES:
        1.  **Persona**: Be friendly, patient, understanding, and encouraging. Use simple, positive language.
        2.  **Language**: You are fluent in English, Hindi, and Hinglish. Adapt your language to match the user's language. For example, if the user says "Exams ka stress hai," you should respond in a similar Hinglish style.
        3.  **Core Function**: Listen actively, validate their feelings (e.g., "That sounds really tough," "It's understandable to feel that way"), and ask gentle, open-ended questions to help them explore their thoughts.
        4.  **Disclaimer**: You are an AI, not a therapist. Do not give medical advice. If the conversation gets deep, you can gently remind them: "Remember, I'm an AI friend here to listen, but for professional advice, talking to a counselor or a trusted adult is always a good idea."
        5.  **CRITICAL SAFETY RULE**: If a user mentions words like 'suicide', 'kill myself', 'end my life', 'hopeless', 'can't go on', 'no reason to live', or expresses clear intent for self-harm, you MUST IMMEDIATELY STOP the conversational flow. Your ONLY response MUST be this exact text, without any modification or additions: "It sounds like you are going through a lot right now, and it takes courage to talk about it. Please know that there are people who want to support you. You can connect with them by calling one of these 24/7 helplines in India: AASRA (9820466726) or Vandrevala Foundation (9999666555). Please reach out to them; they are there to help."
        6.  **Keep it Brief**: Keep your responses concise and easy to read. Avoid very long paragraphs.
        `;

        openChatBtns.forEach(btn => btn.addEventListener('click', openChatWidget));
        closeChatBtn.addEventListener('click', closeChatWidget);
        chatForm.addEventListener('submit', handleFormSubmit);

        function openChatWidget() {
            chatWidget.classList.add('open');
            if (!apiKey && !isAwaitingApiKey && chatMessages.children.length === 0) {
                 isAwaitingApiKey = true;
                 addMessage("Hello! To get started, please enter your Google Gemini API key. I'll remember it just for this session.", 'sahaayai');
                 chatInput.placeholder = 'Enter your API Key here...';
            } else if (apiKey && chatMessages.children.length === 0) {
                 addMessage("Hey, welcome back! I'm SahaayAI. Feel free to talk about anything that's on your mind.", 'sahaayai');
            }
        }

        function closeChatWidget() {
            chatWidget.classList.remove('open');
        }

        async function handleFormSubmit(e) {
            e.preventDefault();
            const userInput = chatInput.value.trim();
            if (!userInput) return;

            if (isAwaitingApiKey) {
                apiKey = userInput;
                sessionStorage.setItem('geminiApiKey', apiKey);
                isAwaitingApiKey = false;
                chatMessages.innerHTML = ''; 
                addMessage("Great, thank you! Your key is set for this session. How can I help you today?", 'sahaayai');
                chatInput.value = '';
                chatInput.placeholder = 'Type your message...';
                return;
            }

            addMessage(userInput, 'user');
            chatHistory.push({ role: "user", parts: [{ text: userInput }] });
            
            chatInput.value = '';
            showTypingIndicator();

            try {
                const aiResponse = await callGeminiAPI(chatHistory);
                addMessage(aiResponse, 'sahaayai');
                chatHistory.push({ role: "model", parts: [{ text: aiResponse }] });
            } catch (error) {
                console.error("API Error:", error);
                addMessage("Oh dear, it seems I'm having a little trouble connecting right now. Please check your API key and try again.", 'sahaayai');
            } finally {
                hideTypingIndicator();
            }
        }

        function addMessage(text, sender) {
            const messageElement = document.createElement('div');
            messageElement.classList.add('chat-bubble', sender);
            messageElement.textContent = text;
            chatMessages.appendChild(messageElement);
            scrollToBottom();
        }

        function showTypingIndicator() {
            const indicator = document.createElement('div');
            indicator.id = 'typing-indicator';
            indicator.classList.add('chat-bubble', 'sahaayai', 'typing-indicator');
            indicator.innerHTML = `<span></span><span></span><span></span>`;
            chatMessages.appendChild(indicator);
            scrollToBottom();
        }
        
        function hideTypingIndicator() {
            const indicator = document.getElementById('typing-indicator');
            if (indicator) {
                indicator.remove();
            }
        }

        function scrollToBottom() {
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        async function callGeminiAPI(history) {
            if (!apiKey) {
                throw new Error("API Key is not set.");
            }
            const model = 'gemini-2.5-flash-preview-05-20';
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${apiKey}`;

            const payload = {
                contents: history,
                systemInstruction: {
                    parts: [{ text: systemPrompt }]
                }
            };
            
            let response;
            let delay = 1000;
            for (let i = 0; i < 5; i++) {
                try {
                    response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (response.ok) {
                        const result = await response.json();
                        if (result.candidates && result.candidates.length > 0 && result.candidates[0].content.parts[0].text) {
                            return result.candidates[0].content.parts[0].text;
                        } else {
                            return "I'm not sure how to respond to that. Could we talk about something else?";
                        }
                    } else if (response.status === 429 || response.status >= 500) {
                        await new Promise(resolve => setTimeout(resolve, delay));
                        delay *= 2;
                    } else {
                        throw new Error(`API request failed with status ${response.status}`);
                    }
                } catch (error) {
                    if (i === 4) {
                       throw error;
                    }
                    await new Promise(resolve => setTimeout(resolve, delay));
                    delay *= 2;
                }
            }
            throw new Error("API request failed after multiple retries.");
        }
    });
    </script>
</body>
</html>

